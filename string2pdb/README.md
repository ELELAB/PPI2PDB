# Description:

- This script extracts filtered interactors for a specified target from the STRING database, using the **STRING API**. 
- It searches only in the **physical** subnetwork of STRING by default, but can be adjusted to parse the entire database (functional network).
- It provides the combined score of the confidence of each interaction (**String score**), along with 
the three components of the physical network interaction score: 
   - **Experimental score**
   - **Database score**
   - **Text mining score**. 
- The **String Score** threshold is adjustable, allowing the user to specify the desired confidence level for extracted interactions. 
- The **Database Score** can be adjusted as well, to specify the desired level of association in curated databases.
- The script requires a csv file with the STRING identifier-Uniprot accession code mappings, which can be generated by running the auxiliary script **string2upac**, from the [STRING human protein alias file](https://stringdb-downloads.org/download/protein.aliases.v12.0/9606.protein.aliases.v12.0.txt.gz]).

# Requirements:

### Software requirements:
Ensure that the following are installed:
- Python 3 (on local server: use `module load python/3.10/modulefile`)
- Python packages:
  - `requests`
  - `pandas`

### Data requirements:
- **CSV file** with the correspondence between STRING identifiers and primary Uniprot accession codes. 
   - The CSV should include columns **'string_protein_id'** and **'primary_uniprot_ac'** for the **stringscore** script to successfully parse it.
   - It can be generated by running the script **string2upac**, that parses the [STRING human protein alias file](https://stringdb-downloads.org/download/protein.aliases.v12.0/9606.protein.aliases.v12.0.txt.gz). The script:
        - extract protein ID mappings
        - query the UniProt API for each protein alias
        - and output all primary UniProt accession codes along with their reviewed status.
   #### How to run string2upac:
   1. Ensure you have the 3 **stringscore** software requirements installed.
   2. Download and unzip locally the STRING human protein alias file.
   3. Activate the Python environment:
         ```bash
         module load python/3.10/modulefile
      ```
   4. Run the **string2upac** executable, providing the path to the **unzipped** STRING human protein alias file, as shown below:
      ```bash
      ./string2upac <path_to_alias_file>
      ```
    > ⚠️ **Note: On bioinfo servers, do not run`string2upac`**. The required CSV is already available in the STRING shared database folder.


# Arguments:
1. `<identifier>` (required, string): Uniprot Accession Code of the target protein.

2. `<threshold>` (optional, float): String_score threshold. Default for MAVISp: **String_score > 0.7**.
   To adjust the String_score threshold, specify with `-t <threshold>`.

   Other recommended thresholds for customized searches along with the confidence of interaction ([source](http://version10.string-db.org/help/getting_started/)):

   | Confidence | Threshold |
   |------------|-----------|
   | Low        | 0.15      |
   | Medium     | 0.4       |
   | High       | 0.7       |
   | Highest    | 0.9       |


3. `<dthreshold>` (optional, float): Database_score threshold. Default for MAVISp: **Database_score > 0**.
   - To adjust the Database_score threshold, specify with `-dt <dthreshold>`. To include all values, specify `-dt -1`.
   - Default value returns interactions for which there is association in at least one of the curated databases that STRING interacts with. 

4. `<network>` (optional, string): Network of the STRING database to be parsed.
   - Default for MAVISp: `'physical'` (Only interactors that are likely to bind to/form complexes with the target).
   - Choices: `'physical'` (subnetwork) or `'functional'` (entire network of the database).
   - To use the functional network, specify: `-n functional`.

5. `<aliases_file_path>`(optional, string): Path to the pre-processed alias file containing STRING ID and UniProt AC mappings.
   - default (for run on bioinfo servers): "/data/databases/STRING/STRING_primary_upac.csv"
   - To use an alternative csv with columns 'string_protein_id' and 'primary_uniprot_ac' present, specify: `--aliases_file_path /custom/path/to/file.csv`

# How to run:
1. Activate the Python environment:
   ```bash
   module load python/3.10/modulefile
   ```
2. Run the script:
   ```bash
   ./stringscore <identifier> [-t <threshold>] [-dt <dthreshold>] [-n <network>] [--aliases_file_path <custom/path/to/file.csv>]
   ```
## Example for MAVISp run:
### Run the bash script run.sh in `example/` folder as bash run.sh it will perform: <br />
   ```bash
   ./stringscore O15315
   ```
## Customized example of run:
### Run the bash script run.sh in `example2/` folder as bash run.sh it will perform: <br />
   ```bash
   ./stringscore Q99728 -t 0.9 -n functional
   ```
## Output:
The output is a csv file generated in the working directory and named after the input UniProt AC:
`{UniProt_AC}_string_interactors.csv`

### CSV File Columns:
| Column Name                | Description                                      |
|----------------------------|--------------------------------------------------|
| **Target_protein**         | Common gene name of the target protein           |
| **Target_Uniprot_AC**      | UniProt AC of the target protein                 |
| **Target_id**              | STRING identifier for the target protein         |
| **Interactor**             | Common gene name of the interacting protein      |
| **Interactor_id**          | STRING identifier for the interactor             |
| **Interactor_UniProt_AC**  | UniProt AC of the interactor                     |
| **String_score**           | Overall confidence score of the interaction      |
| **Experimental_score**     | Score from experimental evidence                 |
| **Database_score**         | Score from database evidence                     |
| **Textmining_score**       | Score from text-mining evidence                  |
